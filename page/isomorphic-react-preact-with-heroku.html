<!DOCTYPE html>
<html>
  <head>
  <meta charset="UTF-8">
  <meta name="description" content="Home page and blog of David Zhang (@crispgm), a minimalist programmer, photographer, and lifehacker."/>
  <title>Isomorphic React/Preact with Heroku | CrispDev</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="canonical" href="https://crispgm.com/page/isomorphic-react-preact-with-heroku.html">
  
  <link rel="alternate" href="https://crisp.dev/page/isomorphic-react-preact-with-heroku.html">
  
  <link rel="alternate" href="https://crispgm.com/feed.xml" type="application/rss+xml" title="RSS">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Sans|Fira+Mono&display=swap">
  <link rel="icon" type="image/x-icon" href="/image/logo.png">
  
  <link rel="stylesheet" href="/assets/css/font.css?v=1627355963">
  
  
  <link rel="stylesheet" href="/assets/css/nord.css">
  
  <link rel="stylesheet" href="/assets/css/style.css">
  <script src="https://use.typekit.net/syr2mmc.js"></script>
  <script>try{Typekit.load({ async: true });}catch(e){}</script>
</head>

  <body>
    <div class="progress-bar"></div>
    <div class="wrapper blog-wrapper content-wrapper">
      <div class="article">
        <div class="article-menu">
          <div class="article-home">
            <a href="/">CrispDev</a>
          </div>
          <div class="article-back">
            <a href="/blog.html"><< Back</a>
          </div>
        </div>
        <div class="article-head">
          <div class="article-title">
            Isomorphic React/Preact with Heroku
          </div>
          <div class="article-date">
            <time datetime="2017-07-06 00:00:00 +0000">July 06, 2017</time>
          </div>
        </div>
        <div class="article-main">
          <p><a href="http://nbrugby.com/">Rugby News Board</a> is the side project mentioned in title, which is a simple news site for Rugby sport in Chinese. I made it because there is no Rugby news site in Chinese and I love Rugby.</p>

<p>Rugby News Board was <a href="https://github.com/crispgm/rugby-board">firstly built</a> with Rails, with simple news channels. By Rails, I could be able to make prototype within 2 days. I wrote a <code class="language-plaintext highlighter-rouge">news</code> table with ORM and SQLite. It ran on Linode VPS and I did DevOps by myself.</p>

<h1 id="heroku">Heroku</h1>

<p>Since I read about the article from Unsplash <a href="https://medium.com/unsplash-unfiltered/scaling-unsplash-with-a-small-team-fbdd55571906"><em>Scaling Unsplash with a small team</em></a>, I realized that I should emigrate from VPS to PaaS to avoid unnecessary cost for infrastructures. I have kept on <a href="/page/containerize-my-vps.html">evaluating containers and other technology</a> on the VPS but it was neither profitable nor productive to the project.</p>

<p>As a result, I started to migrate to <a href="https://heroku.com/">Heroku</a>, as I sought for more efficiency, reliability and convenience. The process didn’t take too much effort. The only major change to my Rails app is that the database was <a href="https://devcenter.heroku.com/articles/sqlite3">changed into Postgres</a>.</p>

<h1 id="isomorphic-javascript">Isomorphic JavaScript</h1>

<p>Rails is flexible both backend and frontend, with components support for everything, and it is a perfect MVC framework for multiple pages application. However, MVVM
is the future, e.g. React. It is a bit more reasonable, elegant and expressive way to make data reactive than modify DOM with jQuery. <strong>Moreover, I just want to keep on track with modern frontend development</strong>.</p>

<p>By the way, I feel quite strange using CoffeeScript, as part of Rails stacks. Being surrounded by Vanilla JavaScript, EcmaScript of all versions, and TypeScript, I have no interest in learning an unpopular JavaScript replacement, which some dudes said it was dead.</p>

<p>I tried using React with <a href="https://github.com/reactjs/react-rails">react-rails</a> to build translating system of Rugby names. It is merely based on Rails, and we can use React Component with <code class="language-plaintext highlighter-rouge">react_component</code> tag and simply pass the data (Ruby objects) to the component seamlessly.</p>

<div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"section-item"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;</span><span class="err">%=</span> <span class="na">react_component</span> <span class="err">"</span><span class="na">RugbyDictQuery</span><span class="err">",</span> <span class="err">{</span><span class="na">title:</span> <span class="err">"</span><span class="na">Rugby</span> <span class="na">Dictionary</span><span class="err">"}</span> <span class="err">%</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div></div>

<p>react-rails is a great binding between Rails and React. But the trend is isomorphic React application as frontend and backends serve only APIs. I read some articles and slides from companies use both Rails and React, such as <a href="https://www.slideshare.net/spikebrehm/the-evolution-of-airbnbs-frontend/"><em>The Evolution of Airbnb’s Frontend</em></a> and <a href="https://medium.com/unsplash-unfiltered/scaling-unsplash-with-a-small-team-fbdd55571906"><em>Scaling Unsplash with a small team</em></a> again.</p>

<p>They both prefered build isomorphic JavaScript application with Node and React. I followed Unsplash, because we use the same PaaS and frameworks.</p>

<h2 id="react-app">React App</h2>

<p>Initially, I setup my project with <a href="https://github.com/verekia/js-stack-from-scratch"><em>JavaScript Stack from Scratch</em></a>. I won’t post many <a href="https://github.com/rugby-board/rugby-board-node">codes</a> here, since it is routine work with React. The only unfortunate thing is that I forgot to use ESLint from start. In consequence, I had to spend hours fixing 200+ issues.</p>

<p>However, Webpack is just like a blackbox and I have to do a lot of work to get it done. What I need to do was to specify my entries and outputs with various kinds of loaders and plugins.</p>

<h2 id="webpack-with-multiple-entries">Webpack with Multiple Entries</h2>

<p>Examples and boilerplates are typically in one HTML form. However, there are two pages in my application. One is <code class="language-plaintext highlighter-rouge">index.html</code> for user requests, the other is <code class="language-plaintext highlighter-rouge">admin.html</code> for editors. Both of them should be equipped with HMR (Hot Module Replacement).</p>

<p>This article is great as the title <a href="https://kuzzmi.com/blog/truly-multiple-entries-with-webpack"><em>Truly Multiple Entries with Webpack</em></a> says.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">path</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">path</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">webpack</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">HtmlWebpackPlugin</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">html-webpack-plugin</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="p">{</span>
  <span class="na">entry</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">index</span><span class="p">:</span> <span class="p">[</span>
      <span class="dl">'</span><span class="s1">webpack-hot-middleware/client</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">./client/index.jsx</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">],</span>
    <span class="na">admin</span><span class="p">:</span> <span class="p">[</span>
      <span class="dl">'</span><span class="s1">webpack-hot-middleware/client</span><span class="dl">'</span><span class="p">,</span>
      <span class="dl">'</span><span class="s1">./client/admin.jsx</span><span class="dl">'</span><span class="p">,</span>
    <span class="p">],</span>
  <span class="p">},</span>
  <span class="na">module</span><span class="p">:</span> <span class="p">{</span>
    <span class="c1">// loaders ...</span>
  <span class="p">},</span>
  <span class="na">resolve</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">extensions</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">.js</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">.jsx</span><span class="dl">'</span><span class="p">],</span>
  <span class="p">},</span>
  <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">path</span><span class="p">:</span> <span class="nx">path</span><span class="p">.</span><span class="nx">resolve</span><span class="p">(</span><span class="nx">__dirname</span><span class="p">,</span> <span class="dl">'</span><span class="s1">..</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">dist</span><span class="dl">'</span><span class="p">),</span>
    <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">[name]/bundle.js</span><span class="dl">'</span><span class="p">,</span>
    <span class="na">publicPath</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/</span><span class="dl">'</span><span class="p">,</span>
  <span class="p">},</span>
  <span class="na">plugins</span><span class="p">:</span> <span class="p">[</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./client/index.html</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">index.html</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">inject</span><span class="p">:</span> <span class="dl">'</span><span class="s1">body</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">chunks</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">index</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">hash</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">HtmlWebpackPlugin</span><span class="p">({</span>
      <span class="na">template</span><span class="p">:</span> <span class="dl">'</span><span class="s1">./client/admin.html</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">filename</span><span class="p">:</span> <span class="dl">'</span><span class="s1">admin.html</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">inject</span><span class="p">:</span> <span class="dl">'</span><span class="s1">body</span><span class="dl">'</span><span class="p">,</span>
      <span class="na">chunks</span><span class="p">:</span> <span class="p">[</span><span class="dl">'</span><span class="s1">admin</span><span class="dl">'</span><span class="p">],</span>
      <span class="na">hash</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">}),</span>
    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">HotModuleReplacementPlugin</span><span class="p">(),</span>
    <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">NoEmitOnErrorsPlugin</span><span class="p">(),</span>
  <span class="p">],</span>
  <span class="na">devServer</span><span class="p">:</span> <span class="p">{</span>
    <span class="na">historyApiFallback</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="p">},</span>
<span class="p">};</span>
</code></pre></div></div>

<h2 id="dev-server">Dev Server</h2>

<p>To get good developer experience, it is important to setup a realtime debugging environment for development. I was prepared to setup dev server for my isomorphic app with webpack-dev-middleware and webpack-hot-middleware.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">webpack</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">webpack</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">webpackConfig</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">../config/webpack.dev.config.js</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">compiler</span> <span class="o">=</span> <span class="nx">webpack</span><span class="p">(</span><span class="nx">webpackConfig</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">webpackDevMiddleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">webpack-dev-middleware</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">webpackHotMiddleware</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="dl">'</span><span class="s1">webpack-hot-middleware</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// Dev</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">webpackDevMiddleware</span><span class="p">(</span><span class="nx">compiler</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">noInfo</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
  <span class="na">publicPath</span><span class="p">:</span> <span class="nx">webpackConfig</span><span class="p">.</span><span class="nx">output</span><span class="p">.</span><span class="nx">publicPath</span><span class="p">,</span>
<span class="p">}));</span>
<span class="c1">// HMR</span>
<span class="nx">app</span><span class="p">.</span><span class="nx">use</span><span class="p">(</span><span class="nx">webpackHotMiddleware</span><span class="p">(</span><span class="nx">compiler</span><span class="p">,</span> <span class="p">{</span>
  <span class="na">log</span><span class="p">:</span> <span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">,</span>
  <span class="na">path</span><span class="p">:</span> <span class="dl">'</span><span class="s1">/__webpack_hmr</span><span class="dl">'</span><span class="p">,</span>
  <span class="na">heartbeat</span><span class="p">:</span> <span class="mi">10</span> <span class="o">*</span> <span class="mi">1000</span><span class="p">,</span>
<span class="p">}));</span>
</code></pre></div></div>

<p>However, things became complex with multiple pages. It seemed that webpack-dev-middleware never actually build files into output path.</p>

<p>The <code class="language-plaintext highlighter-rouge">index.html</code> was always accessbile, while the other page - <code class="language-plaintext highlighter-rouge">admin.html</code> was possibly in some black hole. I resolved it by <a href="https://github.com/jantimon/html-webpack-plugin/issues/145#issuecomment-170554832">serve the files from the compiler</a>.</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">app</span><span class="p">.</span><span class="kd">get</span><span class="p">(</span><span class="dl">'</span><span class="s1">/admin</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">req</span><span class="p">,</span> <span class="nx">res</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
  <span class="kd">const</span> <span class="nx">filename</span> <span class="o">=</span> <span class="nx">path</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="nx">compiler</span><span class="p">.</span><span class="nx">outputPath</span><span class="p">,</span> <span class="dl">'</span><span class="s1">admin.html</span><span class="dl">'</span><span class="p">);</span>
  <span class="nx">compiler</span><span class="p">.</span><span class="nx">outputFileSystem</span><span class="p">.</span><span class="nx">readFile</span><span class="p">(</span><span class="nx">filename</span><span class="p">,</span> <span class="p">(</span><span class="nx">err</span><span class="p">,</span> <span class="nx">result</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
    <span class="nx">res</span><span class="p">.</span><span class="kd">set</span><span class="p">(</span><span class="dl">'</span><span class="s1">content-type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">text/html</span><span class="dl">'</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">result</span><span class="p">);</span>
    <span class="nx">res</span><span class="p">.</span><span class="nx">end</span><span class="p">();</span>
  <span class="p">});</span>
<span class="p">});</span>
</code></pre></div></div>

<p>In the end, I managed to make it work that I can simply start to dev by one command <code class="language-plaintext highlighter-rouge">yarn server</code>, with a Node server, a React app and HMR.</p>

<h2 id="build-after-deployment">Build after Deployment</h2>

<p>Deployment on Heroku is easy, but I had to commit <code class="language-plaintext highlighter-rouge">dist</code> folder to codebase at first, which was really a heavy way (hundreds of kilobytes each push). Then I found <code class="language-plaintext highlighter-rouge">heroku-postbuild</code> hook, by which deployment can trigger Webpack build.</p>

<p>So let’s add <code class="language-plaintext highlighter-rouge">heroku-postbuild</code> to <code class="language-plaintext highlighter-rouge">package.json</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>"heroku-postbuild": "webpack -p --config ./config/webpack.prod.config.js"
</code></pre></div></div>

<p><em>Hint</em>: We should ensure that the build process works before pushing codes. Otherwise, deployment fails.</p>

<h1 id="optimizing-and-preact">Optimizing and Preact</h1>

<p>After the launch of new Node/React application, I could hardly ignore the long gap between the response reached and I saw the page finally. Heroku is commonly laggy in China due to geolocation reason and the great firewall. I put it down to this reason until I found the <code class="language-plaintext highlighter-rouge">bundle.js</code> is 1.8 mb.</p>

<p>The reason is that the Webpack production configuration was wrong, I fixed it by adding <code class="language-plaintext highlighter-rouge">UglifyJsPlugin</code> and it is now 700 kb.</p>

<div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">plugins</span><span class="p">:</span> <span class="p">[</span>
  <span class="nx">HtmlWebpackPluginConfig</span><span class="p">,</span>
  <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">NoEmitOnErrorsPlugin</span><span class="p">(),</span>
  <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">DefinePlugin</span><span class="p">({</span> <span class="dl">'</span><span class="s1">process.env.NODE_ENV</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">"production"</span><span class="dl">'</span> <span class="p">}),</span>
  <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">optimize</span><span class="p">.</span><span class="nx">OccurrenceOrderPlugin</span><span class="p">(),</span>
  <span class="k">new</span> <span class="nx">webpack</span><span class="p">.</span><span class="nx">optimize</span><span class="p">.</span><span class="nx">UglifyJsPlugin</span><span class="p">({</span>
    <span class="na">compress</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">screw_ie8</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
      <span class="na">warnings</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">mangle</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">screw_ie8</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">},</span>
    <span class="na">output</span><span class="p">:</span> <span class="p">{</span>
      <span class="na">comments</span><span class="p">:</span> <span class="kc">false</span><span class="p">,</span>
      <span class="na">screw_ie8</span><span class="p">:</span> <span class="kc">true</span><span class="p">,</span>
    <span class="p">},</span>
  <span class="p">}),</span>
<span class="p">],</span>
</code></pre></div></div>

<p>Even 700 kb is a considerably large size. And then I came up with an idea of using <a href="https://github.com/developit/preact">Preact</a>, “Fast 3kb React alternative with the same ES6 API”, which is confirmed by my frontend expert friend <a href="https://github.com/yanni4night">@yanni4night</a>.</p>

<p>I had no many codes so I use Preact directly, without using preact-compat to make it compatible with React.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>import { h, Component } from 'preact';
</code></pre></div></div>

<p>It goes as soon as I change the import statements on the top.</p>

<p><code class="language-plaintext highlighter-rouge">react-router</code> was replaced by <code class="language-plaintext highlighter-rouge">preact-router</code>, which is even more user-friendly. The parameters are simply passed to <code class="language-plaintext highlighter-rouge">props</code>:</p>

<p>Router:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;EventPage path="/event/:name" /&gt;
</code></pre></div></div>

<p>EventPage Component:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>export default class EventPage extends Component {
  constructor(props) {
    super(props);

    this.state = {
      eventName: props.name,
      pageNum: props.page || 0,
    };
  }
}
</code></pre></div></div>

<p>After the optimization, it is <em>only</em> 364 kb and typically takes less than 2 seconds to load the application. Using Preact is a good choice, while we can get the advantage of React and benefit from the lightweight.</p>

<p>At last, <strong>DO NOT</strong> forget to turn on <code class="language-plaintext highlighter-rouge">gzip</code> of your Express server or other static file server like Nginx. That dramatically cuts the bundle size to 1/4, which is less than 100kb now.</p>

<h1 id="conclusion">Conclusion</h1>

<p>The development experience of frontend is great, with fancy frameworks, tools and developer’s ecology. It evolves very fast, faster than evolvement of its documentation. The examples of the documentations fail frequently as version increases fast. But, it’s fantastic that they often give accurate migration advice so that I can fix immediately. For other problems, StackOverflow provides strong supports as frontend people are the most vigorous in the industry.</p>

        </div>
        <div class="article-share">
          <a href="https://twitter.com/share?url=https%3A%2F%2Fcrispgm.com%2Fpage%2Fisomorphic-react-preact-with-heroku.html&text=Isomorphic+React%2FPreact+with+Heroku">
            <i class="icon-twitter"></i>
          </a>
          
          <a href="tg://msg_url?url=https%3A%2F%2Ft.me%2Fiv%3Furl%3Dhttps%253A%252F%252Fcrispgm.com%252Fpage%252Fisomorphic-react-preact-with-heroku.html%26rhash%3Da3e6c7b51eec6a">
            <i class="icon-telegram"></i>
          </a>
          <a href="https://www.buymeacoffee.com/crispgm">
            <i class="icon-coffee"></i>
          </a>
        </div>
        <div id="disqus_thread" class="article-comment"></div>
        <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
      </div>
    </div>
    <footer class="wrapper" id="contact">
  <div class="content">
    <div class="contact">
      <div class="contact-links">
        <a href="mailto:crispgm@gmail.com"><i class="icon-envelope-o"></i></a>
        <a href="/feed.xml"><i class="icon-rss"></i></a>
        <a href="https://github.com/crispgm"><i class="icon-github"></i></a>
        <a href="https://stackoverflow.com/users/6858150/david-zhang/"><i class="icon-stack-overflow"></i></a>
        <a href="https://instagram.com/crispgm"><i class="icon-instagram"></i></a>
        <a href="https://twitter.com/crispgm"><i class="icon-twitter"></i></a>
      </div>
      <div class="contact-copyright">
        <a href="https://crispgm.com">David Zhang</a> &copy; 2021
      </div>
    </div>
  </div>
</footer>

    
<script src="/assets/scripts/highlight.pack.js"></script>
<script>hljs.initHighlightingOnLoad();</script>


    
<script>
var disqus_config = function () {
  this.page.identifier = '/page/isomorphic-react-preact-with-heroku.html';
};

(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://crispgm.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>


  </body>
  <script>
document.addEventListener('scroll', function(e) {
  var wrapper   = document.querySelector('.blog-wrapper');
  var article   = document.querySelector('.article');
  var docHeight = wrapper.offsetHeight;
  var maxHeight = docHeight - window.innerHeight - article.offsetTop;
  var scrollTop = window.scrollY || window.scollTop || document.getElementsByTagName("html")[0].scrollTop;
  var ratio = scrollTop / maxHeight;
  var progressBar = document.querySelector('.progress-bar');
  var winWidth  = window.innerWidth;
  if (ratio <= 1.0) {
    progressBar.style.width = winWidth * ratio + 'px';
  }
  else {
    progressBar.style.width = winWidth + 'px';
  }
});
</script>

  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50708664-1', 'auto');
  ga('send', 'pageview');
</script>
</html>
