<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="description" content="A minimalist programmer, photographer and lifes lover."/>
    <title>MySQL 更新多条记录的不同值 | David Zhang</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="canonical" href="https://crispgm.com/page/mysql-update-multirows.html">
    <link rel="alternate" href="https://crisp.lol/page/mysql-update-multirows.html">
    <link rel="alternate" href="https://crispgm.com/feed.xml" type="application/rss+xml" title="RSS">
    <link href="//fonts.googleapis.com/css?family=Noto+Sans" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet">
    <link rel="icon" type="image/x-icon" href="/image/logo.png">
    
    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/animatecss/3.5.2/animate.min.css">
    
    <link rel="stylesheet" href="/assets/css/tomorrow-night-eighties.css">
    
    
    <link rel="stylesheet" href="/assets/css/style.css">
  </head>
  <body>
    <div class="content" id="header">
          <header class="content-wrapper menu">
      <div class="menu-links">
        <div class="menu-item">
          <a href="/blog.html">Blog</a>
        </div>
        <div class="menu-item">
          <a href="/project.html">Project</a>
        </div>
        <div class="menu-item">
          <a href="/wiki/">Wiki</a>
        </div>
        <div class="menu-item">
          <a href="/about.html">About</a>
        </div>
      </div>
      <div class="menu-bars">
        <i id="dropdown-button" class="fa fa-bars"></i>
      </div>
      <div class="menu-home">
        <a href="/">DAVID ZHANG</a>
      </div>
    </header>

    </div>
    <div class="content" id="main-content">
      <div class="content-wrapper">
        <div class="article">
  <div class="article-head">
    <div class="article-title">MySQL 更新多条记录的不同值</div>
    <div class="article-date">September 12, 2014</div>
  </div>
  <div class="article-main">
    <p>MySQL语句使用过程中，会用到一些多行更新的场景。比较常见的是，把多行都更新成同一个值。如：</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="k">table_name</span>  
<span class="k">SET</span> <span class="n">column_value</span><span class="o">=</span><span class="mi">1</span>  
<span class="k">WHERE</span> <span class="n">column_id</span> <span class="k">IN</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</code></pre>
</div>

<p>如果更新多行数据，且值是不同的，往往会使用for循环进行更新。如：</p>

<div class="language-php highlighter-rouge"><pre class="highlight"><code>foreach ($data_list as $item) {  
    $sql = "UPDATE table_name SET column={$item['value']} WHERE column={$item['id']}";  
    $ret = mysql_query($sql);  
    if ($ret === false) {  
        //...
    }  
}  
</code></pre>
</div>

<p>这样写网络交互次数比较多，可能会导致性能问题，看起来也不优雅。
那能否一条SQL搞定呢？答案是肯定的。</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="k">table_name</span>  
<span class="k">SET</span> <span class="n">column_value</span> <span class="o">=</span> <span class="k">CASE</span> <span class="n">column_id</span>  
    <span class="k">WHEN</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="mi">0</span>  
    <span class="k">WHEN</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="mi">1</span>  
    <span class="k">WHEN</span> <span class="mi">3</span> <span class="k">THEN</span> <span class="mi">2</span>  
<span class="k">WHERE</span> <span class="n">column_id</span> <span class="k">IN</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</code></pre>
</div>

<p>同理，也可以使用此方法设置多行多个值。</p>

<div class="language-sql highlighter-rouge"><pre class="highlight"><code><span class="k">UPDATE</span> <span class="k">table_name</span>  
<span class="k">SET</span> <span class="n">column_value</span> <span class="o">=</span> <span class="k">CASE</span> <span class="n">column_id</span>  
    <span class="k">WHEN</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="mi">0</span>  
    <span class="k">WHEN</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="mi">1</span>  
    <span class="k">WHEN</span> <span class="mi">3</span> <span class="k">THEN</span> <span class="mi">2</span><span class="p">,</span>  
<span class="k">SET</span> <span class="n">column_desc</span> <span class="o">=</span> <span class="k">CASE</span> <span class="n">column_id</span>  
    <span class="k">WHEN</span> <span class="mi">1</span> <span class="k">THEN</span> <span class="s1">'test 1'</span>
    <span class="k">WHEN</span> <span class="mi">2</span> <span class="k">THEN</span> <span class="s1">'test 2'</span>
    <span class="k">WHEN</span> <span class="mi">3</span> <span class="k">THEN</span> <span class="s1">'test 3'</span>
<span class="k">WHERE</span> <span class="n">column_id</span> <span class="k">IN</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>
</code></pre>
</div>

<p>END.</p>

  </div>
  <div id="disqus_thread" class="article-comment"></div>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
</div>

      </div>
    </div>
        <footer>
      <div class="content-wrapper contact" id="contact">
        <div class="contact-links">
          <a href="mailto:crispgm@gmail.com"><i class="fa fa-envelope-o"></i></a>
          <a href="/feed.xml"><i class="fa fa-rss"></i></a>
          <a href="https://github.com/crispgm"><i class="fa fa-github"></i></a>
          <a href="https://stackoverflow.com/users/6858150/david-zhang/"><i class="fa fa-stack-overflow"></i></a>
          <a href="https://instagram.com/crispgm"><i class="fa fa-instagram"></i></a>
          <a href="https://twitter.com/crispgm"><i class="fa fa-twitter"></i></a>
          <a href="http://medium.com/@crispgm"><i class="fa fa-medium"></i></a>
          <a href="https://www.linkedin.com/in/wanlong-zhang"><i class="fa fa-linkedin"></i></a>
        </div>

        <div class="contact-copyright">
          David Zhang &copy; 2017
        </div>
      </div>
    </footer>
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        isToggle = false;

        document.body.addEventListener("click", function(evt){
          if (isToggle && evt.target.id != 'dropdown-button') {
            toggleMenu();
          }
        });

        var dropdown = document.querySelector("#dropdown-button");
        dropdown.addEventListener("click", function(evt) {
          toggleMenu();
        });

        document.body.addEventListener("touchstart", function(evt){
          evt.stopPropagation();
        });
      }, false);

      function toggleMenu() {
        var menuElement = document.querySelector(".menu-links");
        var dropdownElement = document.querySelector("#dropdown-button");
        if (isToggle) {
          menuElement.classList.remove("menu-dropdown");
          menuElement.classList.remove("animated");
          menuElement.classList.remove("fadeIn");
          dropdownElement.classList.remove("fa-close");
          dropdownElement.classList.add("fa-bars");
        }
        else {
          menuElement.classList.add("menu-dropdown");
          menuElement.classList.add("animated");
          menuElement.classList.add("fadeIn");
          dropdownElement.classList.remove("fa-bars");
          dropdownElement.classList.add("fa-close");
        }
        isToggle = !isToggle;
      }
    </script>
    
    <script src="/assets/scripts/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-50708664-1', 'auto');
      ga('send', 'pageview');
    </script>
    
    <script>
    var disqus_config = function () {
      this.page.identifier = '/page/mysql-update-multirows.html';
    };
    
    (function() { // DON'T EDIT BELOW THIS LINE
    var d = document, s = d.createElement('script');
    s.src = 'https://crispgm.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
    })();
    </script>
    
  </body>
</html>