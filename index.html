<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Crisp Home</title>
<link rel="stylesheet" href="http://crispgm.github.io/static/bootstrap.min.css">
<link rel="stylesheet" href="http://crispgm.github.io/static/bootstrap-theme.min.css">
<link rel="stylesheet" href="http://crispgm.github.io/static/style.css">
<link rel="stylesheet" href="http://crispgm.github.io/static/vs.css">
<script src="http://crispgm.github.io/static/highlight.pack.js"></script>
<script src="http://crispgm.github.io/static/bootstrap.min.js"></script>
<script src="http://crispgm.github.io/static/jquery-2.0.3.min.js"></script>
<script>hljs.initHighlightingOnLoad();</script>
</head>
<body>
<div class="container">
    <div class="navbar navbar-default" role="navigation">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="http://crispgm.github.io/">Crisp Home</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav navbar-right">
            <li><a href="http://github.com/crispgm">Github</a></li>
            <li><a href="http://crispgm.github.io/page/about.html">About</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
</div>
<div class="container">

<div class="article">
<div class="article_head">
<div class="article_title"><a href="http://crispgm.github.io/page/fiddler-proxy.html">Fiddler网络调试工具</a></div>
<div class="article_date">2014/03/21</div>
</div>
<div class="article_main">
<h3>什么是Fiddler</h3>

<p>Fiddler官方给Fiddler的描述语是Web Debugging Proxy，也就是web调试代理工具。</p>

<p>主要功能有：</p>

<ul>
<li><p>截取HTTP/HTTPS请求</p></li>
<li><p>修改Session</p></li>
<li><p>网络调试</p></li>
<li><p>安全测试</p></li>
<li><p>性能测试</p></li>
</ul>

<p>本文，主要讨论前三项功能的使用方法，包括Fiddler的基础配置和功能以及使用内置FiddlerScript脚本进行复杂功能调试。</p>

<h3>准备和配置</h3>

<p>Fiddler使用C#开发，支持Windows XP以上版本。对于Linux和Mac用户，有一个基于Mono的Alpha版本，经本人Mac实际测试，基本上算是不能用的状态。因此，不建议使用。</p>

<p>下载地址：<a href="http://www.telerik.com/download/fiddler">http://www.telerik.com/download/fiddler</a></p>

<p>安装完毕后，为了使用后续功能，建议安装<a href="http://www.telerik.com/download/fiddler/fiddlerscript-editor">FiddlerScript Editor</a>插件，否则修改FiddlerScript会比较麻烦。</p>

<p>准备完毕后，请打开Fiddler进入Tools->Fiddler Options，在Connections中勾选Allow remote computers to connect，并重新启动Fiddler。</p>

<h3>网络请求抓取</h3>

<p>完成了上述设置后，Fiddler就已经可以抓取本地的网络请求。如果需要对手机app进行调试，则需要设置手机代理。</p>

<pre><code>iPhone  
进入Settings -&gt; WLAN，单击你连接中的WIFI，在HTTP PROXY下选择Manual，然后Server填写Fiddler所在机器在此WIFI中的IP地址，Port是默认的8888。

Android
进入设置 -&gt; WIFI，长按你连接中的WIFI，点击修改网络网络，勾选高级选项，在HTTP代理中填写主机名和端口。
</code></pre>

<p><img src="http://crispgm.github.io/image/fiddler/capturing.png" alt="Fiddler Capturing" /></p>

<p>选中请求后，可以查看Headers、Cookies和多种模式的(TextView/WebForms等)请求参数。</p>

<p><img src="http://crispgm.github.io/image/fiddler/request.png" alt="Fiddler Request" /></p>

<p>如果想查看Response，则可以选中请求后点击Inspectors或者直接双击请求查看响应Headers和多种格式的响应内容。对于常见的数据结构，可以格式化展示JSON或XML。</p>

<p><img src="http://crispgm.github.io/image/fiddler/response.png" alt="Fiddler Response" /></p>

<h3>Web Debugging</h3>

<p>在进行调试时，我们可以使用Fiddler的几种调试功能：</p>

<ul>
<li>HOSTS</li>
</ul>

<p>等同于操作系统的HOSTS文件。</p>

<ul>
<li>Filters</li>
</ul>

<p>可以修改Request或Response的包体。</p>

<ul>
<li>AutoResponder</li>
</ul>

<p>可以截获请求，直接将请求代理到指定URL进行响应。</p>

<ul>
<li>FiddlerScript</li>
</ul>

<p>以FiddlerScript(C#)形式，实现Filters和AutoResponder的所有功能，并且可以定制UI界面。</p>

<h3>HOSTS</h3>

<p>Fiddler自带有HOSTS功能，跟Windows自带的HOSTS应该是一回事，不过在Fiddler中操作比较方便。</p>

<p>而是直接从菜单进入Tools -> HOSTS...，勾选Enable remapping of requests(此处省略数十字)，就可以把请求线上服务通过HOST方式，代理到沙盒或者测试机。</p>

<p><img src="http://crispgm.github.io/image/fiddler/hosts.png" alt="Fiddler Hosts" /></p>

<h3>Filters</h3>

<p>很多时候，客户端一次行为可能会产生多次HTTP请求，会造成很大的干扰，Filter功能就可以选择性截取</p>

<p>首先进入Filters标签，勾选Use Filters</p>

<p>在Request Headers中，勾选Show only if URL contains，并在后面的输入框中填写希望截取的URL。同理，也可以勾选Hide if URL contains，隐藏特定的请求。</p>

<p>除此之外，还可以直接修改Request或Response包体。</p>

<p><img src="http://crispgm.github.io/image/fiddler/filters.png" alt="Fiddler Filters" /></p>

<h3>AutoResponder</h3>

<p>AutoReponder可以截获Request URL，并用其他URL进行Respond。利用AutoResponder，也可以实现将请求引导到指定机器的功能。</p>

<p>将原URL截获后，甚至可以直接修改URL。截图请求时也可以有很多方式，包括URL正则匹配、包体匹配和Headers匹配等。</p>

<p><img src="http://crispgm.github.io/image/fiddler/autoresponder.png" alt="Fiddler AutoResponder" /></p>

<h3>FiddlerScript</h3>

<p>FiddlerScript以C#语言形式，直接修改Request和Response，对于熟练的专业用户来说，会更加方便灵活。</p>

<p>打开FiddlerScript标签，在OnBeforeRequest函数中修改：</p>

<blockquote>
  <p>添加Headers</p>
</blockquote>

<pre><code>oSession.oRequest["http_net_type"] = "1";
</code></pre>

<blockquote>
  <p>添加Cookies</p>
</blockquote>

<pre><code>// 增加预览机标识
oSession.oRequest.headers.Add("Cookie", "pub_env=1");
</code></pre>

<blockquote>
  <p>匹配URL，防止添加的字段干扰到其他网页</p>
</blockquote>

<pre><code>if (oSession.uriContains("c.tieba.baidu.com")) {  
    oSession.oRequest.headers.Add("Cookie", "pub_env=1");  
}
</code></pre>

<p>更多用法，请参考<a href="http://docs.telerik.com/fiddler/knowledgebase/fiddlerscript/modifyrequestorresponse">Fiddler Documentation</a></p>
</div></div>
<div class="article">
<div class="article_head">
<div class="article_title"><a href="http://crispgm.github.io/page/mac-sound.html">Macbook合盖子或者休眠后没声音</a></div>
<div class="article_date">2014/03/08</div>
</div>
<div class="article_main">
<p>在安装有OSX 10.9 Mavericks的Mac中，包括升级或者直接购买的Mac，在合上盖子或者休眠重开后，经常会遇到没有声音的情况<br />
忍了很久后，今天终于找到<a href="http://www.v2ex.com/t/95465">解决方法</a></p>

<p>简单的说，就是在Terminal执行下面两条</p>

<pre><code>sudo kextunload /System/Library/Extensions/AppleHDA.kext  
sudo kextload /System/Library/Extensions/AppleHDA.kext
</code></pre>
</div></div>
<div class="article">
<div class="article_head">
<div class="article_title"><a href="http://crispgm.github.io/page/mac-mail.html">Mac Mail无法退出</a></div>
<div class="article_date">2014/01/10</div>
</div>
<div class="article_main">
<p>Mac Mail在国内网络状况下，和gmail一起总是会有点问题</p>

<p>收件箱里选择删除一封gmail邮件，并用command+q关掉Mail</p>

<p>如果删除gmail失败的话就会报错，之后Mail就会处于一种卡死的状态，退不出来也进不去</p>

<p>只能选择</p>

<pre><code>ps aux|grep Mail
kill -9 xxxx
</code></pre>

<p>这个事情遇多了，搞了个更简单粗暴的shell脚本</p>

<pre><code>#!/bin/bash
PID=$(ps aux|grep $1|grep -v grep|tail -1|awk '{print $2}')
kill -9 $PID
</code></pre>

<p>执行一键暴力杀死Mail进程（重名被误杀后果自负）</p>

<pre><code>sh kill.sh Mail
</code></pre>
</div></div>
<div class="article">
<div class="article_head">
<div class="article_title"><a href="http://crispgm.github.io/page/shell-tips.html">shell两个小问题解决方法</a></div>
<div class="article_date">2013/12/30</div>
</div>
<div class="article_main">
<p>最近，在工作种遇到了两个有点棘手的问题。前者是不小心打错命令建立了一个"--"两个减号开头的文件，想删除删不掉；后者是，减少机器后单机文件数过多，导致定时脚本里的tar执行失败了。</p>

<h4>在shell中删除减号开头的文件</h4>

<p>解决方法：</p>

<pre><code>rm -- "--xxxx"
</code></pre>

<h4>argument list too long</h4>

<p>由于文件数增加，脚本出现错误tar: argument list too long，也就是说tar参数太多了</p>

<p>解决方法：</p>

<pre><code>find /path/to/crash_log/20131229 -name '*crash*' -print &gt; /tmp/20131229.list  
tar zcf /path/to/client_log/20131229.tar.gz --files-from /tmp/20131229.list  
rm /tmp/20131229.list
</code></pre>
</div></div>
<div class="article">
<div class="article_head">
<div class="article_title"><a href="http://crispgm.github.io/page/inspiring-songs.html">Land of Hope and Glory</a></div>
<div class="article_date">2013/11/25</div>
</div>
<div class="article_main">
<p>这首歌本来没歌词，名叫《威风堂堂》进行曲(Pomp and Circumstance March No.1 in D major，威风堂堂D大调第一进行曲)，英国著名作曲家埃尔加作曲。后来加上了歌词后，变成了著名爱国歌曲，甚至英格兰橄榄球队的“国歌”就是它。不过一般来说在前面一堆是不会唱的，只有副歌(Chorus)部分才会唱。</p>

<blockquote>
  <p>Land of hope and glory,<br />
  Mother of the free.</p>
  
  <p>How shall we extol thee,<br />
  who are born of thee.</p>
  
  <p>Wider still and wider,<br />
  shall thy bounds be set?</p>
  
  <p>God who made thee mighty,<br />
  make thee mightier yet.</p>
</blockquote>

<p>本人渣翻译：</p>

<blockquote>
  <p>希望与光荣之地，<br />
  自由的母亲。</p>
  
  <p>我等为你而生，<br />
  该怎样赞美你？</p>
  
  <p>疆界在变广，<br />
  什么时候能被设定。</p>
  
  <p>让你碉堡的神，<br />
  使你更加碉堡。</p>
</blockquote>

<p>这段歌词的确很霸气，第二段第一句，当然对比起现在英国的国力，这歌词的内容已经名存实亡了很多</p>

<p>附上视频链接：<a href="http://v.youku.com/v_show/id_XMjA3NDIwMzA0.html">BBC Proms - Land of Hope and Glory</a></p>

<p>合唱：BBC Singers, BBC Symphony Chorus<br />
演奏：BBC Symphony Orchestra<br />
指挥：Jiří Bělohlávek  </p>
</div></div>
<div class="article">
<div class="article_head">
<div class="article_title"><a href="http://crispgm.github.io/page/guangzhou-fc.html">恒大夺冠</a></div>
<div class="article_date">2013/11/09</div>
</div>
<div class="article_main">
<p>随着终场哨声的响起，恒大有惊无险的夺冠了！</p>

<p>亚冠冠军。</p>

<p>在最后10分钟，紧张的不敢坐着，跪在地上扶着桌子，准备最后时刻跳起来！</p>

<p>想起大学时踢新生杯和院系杯时，就是这种心情。</p>

<p>紧张而煎熬，最后胜利时感觉全场都疯狂了。</p>
</div></div>
<nav id="page_num"><a href="http://crispgm.github.io/index-2.html" id="next">Next</a></nav></div>
<div>
<footer>
	Copyright &copy; Crisp, 2014.
</footer>
</div>
</body>
</html>
